{{ $ := .root }}
{{ $page := .page }}
{{ $pubs_len := len (where $.Site.RegularPages "Type" "press") }}

<!-- Publications widget -->
<div class="row">
  <div class="col-xs-12 col-md-3 section-heading">
    <h1>{{ with $page.Title }}{{ . | markdownify }}{{ end }}</h1>
    {{ with $page.Params.subtitle }}<p>{{ . | markdownify }}</p>{{ end }}
  </div>
  <div class="col-xs-12 col-md-9">
    {{ with $page.Content }}<p>{{ . | markdownify }}</p>{{ end }}

    {{ with (where $.Site.RegularPages "Type" "press") }}
      {{ $counter := 0 }}
      {{ range sort (.GroupByParam "grouping") }} 
      <h1 id="{{ .Key | urlize }}" class="section-heading">
        {{ if ne $counter 0 }}
        <br>
        {{ end }}
        {{ $counter = add $counter 1 }}
        {{ .Key | markdownify }}
        <hr>
      </h1>
        {{ range $press := .Pages }}
          <div class="row press-list-item" itemscope itemtype="http://schema.org/CreativeWork">
            <div class="col-xs-3 vcenter">
              <a href="{{ $press.Params.article_url }}" target="_blank">
                <img src={{ "/img/" | relURL }}{{ $press.Params.image }} itemprop="image" class="press-logo" align="left">
              </a>
            </div>
            <div class="col-xs-8 vcenter">
              <a href="{{ $press.Params.article_url }}" target="_blank">{{ $press.Params.site_title | markdownify }}</a>
              {{ $press.Params.rest | markdownify }}
            </div>
          </div>
        {{ end }}
      {{ end }}
    {{ end }}

  </div>
</div>
